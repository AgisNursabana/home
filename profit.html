<!DOCTYPE html>
<html lang="id">
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <meta charset="UTF-8">
  <title>Summary Income & Modal</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTE8W_SyQn3cYpIFhkE4jl4i3ZInQeiRF2HoiY3JnXYUgeXhnnjRIA0XcQ2&s=10');
      padding: 20px;
      background-size: cover;
  background-position: center;
      height: 1700px;
    }
    h2 {
      text-align: center;
      font-size: 50px;
      margin-bottom: 20px;
      background-color: white;
    }
    section {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
    }
    label, input {
      font-size: 18px;
      margin: 10px 0;
      display: block;
    }
    ul {
      font-size: 18px;
      padding: 10px;
      list-style: none;
      display: none;
    }
    ul li {
      margin: 6px 0;
      display: none;
    }
    strong {
      font-size: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
      display: none;
    }
    table, th, td {
      border: 1px solid #ccc;
      padding: 8px;
      display: none;
    }
    th {
      background: #eee;
      display: none;
    }
    .hasil-bersih {
      font-size: 26px;
      font-weight: bold;
      color: darkgreen;
      margin-top: 20px;
      text-align: center;
    }



  footer {
  background-color: #28384B;
  color: #fff;
  padding: 20px;
  text-align: center;
  border-top: 1px solid #444;
  bottom: 0;
}

footer h3 {
  margin-bottom: 20px;
  font-size: 28px;
  font-family: arial;
  
}

p{
font-size: 30px;
font-family: arial;
}

#email a{
  color: white;
  text-decoration: none;
  margin-left: 150px;
  margin-right: 95px;
  font-size: 24px;
}

#wa a{
  color: white;
  text-decoration: none;
  margin-left: 0px;
  margin-right: 95px;
  font-size: 24px;
}

footer a i {
  font-size: 24px;
  
}

footer p {
  font-size: 24px;
}


  </style>
</head>
<body>
  <h2>SUMMARY TOTAL PROFIT</h2>

  <!-- Bagian Income -->
  <section>
    <h3>Income</h3>
    <label for="tanggal">Pilih Tanggal:</label>
    <input type="date" id="tanggal">
    <ul id="daftar-income"></ul>
    <h3>Total Income Semua Tanggal: <span id="total-semua"></span></h3>
    <canvas id="incomeChart"></canvas>
  </section>

  <!-- Bagian Modal -->
  <section>
    <h3>Input Modal</h3>
    <form id="modalForm">
      <label for="tanggalModal">Tanggal:</label>
      <input type="date" id="tanggalModal" required>
      <label for="jumlahModal">Jumlah Modal:</label>
      <input type="number" id="jumlahModal" required>
      <button type="submit">Simpan Modal</button>
    </form>

    <h3>Data Modal</h3>
    <table>
      <thead>
        <tr><th>Tanggal</th><th>Modal</th></tr>
      </thead>
      <tbody id="tabelModal"></tbody>
    </table>

    <h3>Total Modal: <span id="totalModal"></span></h3>
  </section>

  <!-- Bagian Keuntungan Bersih -->
  <section>
    <h3>Keuntungan Bersih</h3>
    <div class="hasil-bersih" id="keuntunganBersih">Rp0</div>
  </section>

<footer>                                                        
  <h3>CONTACT US :</h3>
  <div style="display: flex; font-family: 'Arial';  margin-bottom: 24px;">
    <div id="email"><a href="mailto:agisnursabana@gmail.com" target="blank" ">
      <i class="fa fa-envelope"></i> agisnursabana@gmail.com
    </a></div>
    <div id="wa"><a href="https://wa.me/6285810635520?text=Hello%20Dimsum%20kai%20%F0%9F%98%8A">                                                                                                           <i class="fab fa-whatsapp" ></i> 085810635520
    </a></div>
  </div>
  <p>&copy; 2025 Dimsum Kai</p>
</footer>


  <script>
    // === URL DATA ===
    const INCOME_URL = "https://opensheet.elk.sh/1UrnTWRNA1cbVjcF_gy53fcccwW87tyub1Ogyp1s8nI0/Orderan%20Dimsum"; // ganti sesuai income
    const MODAL_API = "https://script.google.com/macros/s/AKfycbw6iFxtJYvYPRtNi7mAcbWreNgXrWXzd9AnohhW6HupdE74dLLoNWK7yA5BldSLIUSL1Q/exec"; // ganti sesuai Web App Apps Script modal

    // === Variabel ===
    let orderan = [];
    let incomePerTanggal = {};
    let totalIncomeSemua = 0;
    let totalModal = 0;
    let chart;

    const ctx = document.getElementById("incomeChart").getContext("2d");
    const totalSemuaEl = document.getElementById("total-semua");
    const totalModalEl = document.getElementById("totalModal");
    const keuntunganBersihEl = document.getElementById("keuntunganBersih");

    // === AMBIL DATA INCOME ===
    fetch(INCOME_URL)
      .then(res => res.json())
      .then(data => {
        orderan = data;
        hitungIncomeSemuaTanggal();
        updateKeuntungan();
      });

    function hitungIncomeSemuaTanggal() {
      incomePerTanggal = {};
      totalIncomeSemua = 0;

      orderan.forEach(o => {
        const tanggal = o["Tanggal Bersih"];
        const porsi = parseInt(o["Jumlah/ Porsi"]) || 0;
        const jenis = o.Orderan;

        // Ambil angka isi
        const matchIsi = jenis.match(/isi\s*(\d+)/i);
        const isiPerPorsi = matchIsi ? parseInt(matchIsi[1]) : 1;

        let hargaPerPorsi = 0;
        if (jenis.toLowerCase().includes("mentai") && isiPerPorsi === 5) {
  hargaPerPorsi = 20000;
} else if (jenis.toLowerCase().includes("goreng") && isiPerPorsi === 4) {
  hargaPerPorsi = 18000;
} else if (jenis.toLowerCase().includes("kuah") && isiPerPorsi === 4) {
  hargaPerPorsi = 18000;
}

        const totalHarga = porsi * hargaPerPorsi;
        totalIncomeSemua += totalHarga;

        if (incomePerTanggal[tanggal]) {
          incomePerTanggal[tanggal] += totalHarga;
        } else {
          incomePerTanggal[tanggal] = totalHarga;
        }
      });

      totalSemuaEl.textContent = `Rp${totalIncomeSemua.toLocaleString()}`;
      tampilkanChart();
    }

    function tampilkanChart() {
      const labels = Object.keys(incomePerTanggal);
      const data = Object.values(incomePerTanggal);

      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{ label: 'Income per Tanggal (Rp)', data: data }]
        },
        options: { responsive: true }
      });
    }

    // === TAMPILKAN INCOME HARIAN ===
    document.getElementById("tanggal").addEventListener("input", (e) => {
      const tanggalDipilih = e.target.value;
      const hasil = document.getElementById("daftar-income");
      hasil.innerHTML = "";

      const orderanHariIni = orderan.filter(o => o["Tanggal Bersih"] === tanggalDipilih);
      if (orderanHariIni.length === 0) {
        hasil.innerHTML = `<li>Tidak ada orderan pada ${tanggalDipilih}</li>`;
        return;
      }

      let totalIncome = 0;
      orderanHariIni.forEach(o => {
        const porsi = parseInt(o["Jumlah/ Porsi"]) || 0;
        const jenis = o.Orderan;

        const matchIsi = jenis.match(/isi\s*(\d+)/i);
        const isiPerPorsi = matchIsi ? parseInt(matchIsi[1]) : 1;

        let hargaPerPorsi = 0;
        if (jenis.toLowerCase().includes("mentai") && isiPerPorsi === 5) {
  hargaPerPorsi = 15000;
} else if (jenis.toLowerCase().includes("goreng") && isiPerPorsi === 4) {
  hargaPerPorsi = 15000;
} else if (jenis.toLowerCase().includes("kuah") && isiPerPorsi === 4) {
  hargaPerPorsi = 15000;
}

        const totalHarga = porsi * hargaPerPorsi;
        totalIncome += totalHarga;

        const li = document.createElement("li");
        li.textContent = `${o.Nama} | ${jenis} | ${porsi} porsi Ã— Rp${hargaPerPorsi.toLocaleString()} = Rp${totalHarga.toLocaleString()}`;
        hasil.appendChild(li);
      });

      hasil.innerHTML += `<li><strong>Total Income Hari Itu: Rp${totalIncome.toLocaleString()}</strong></li>`;
    });

    // === AMBIL DATA MODAL ===
    async function loadModal() {
      let res = await fetch(MODAL_API + "?action=getData");
      let data = await res.json();

      let tbody = document.getElementById("tabelModal");
      tbody.innerHTML = "";
      totalModal = 0;

      for (let i = 1; i < data.length; i++) {
        let row = data[i];
        let tanggal = row[0];
        let modal = parseInt(row[1]) || 0;
        totalModal += modal;

        let tr = document.createElement("tr");
        tr.innerHTML = `<td>${tanggal}</td><td>Rp${modal.toLocaleString()}</td>`;
        tbody.appendChild(tr);
      }

      totalModalEl.textContent = `Rp${totalModal.toLocaleString()}`;
      updateKeuntungan();
    }

    // === SIMPAN MODAL ===
    document.getElementById("modalForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      let tanggal = document.getElementById("tanggalModal").value;
      let modal = document.getElementById("jumlahModal").value;

      await fetch(MODAL_API, {
        method: "POST",
        body: JSON.stringify({tanggal, modal})
      });

      loadModal();
    });

    // === HITUNG KEUNTUNGAN ===
    function updateKeuntungan() {
      let bersih = totalIncomeSemua - totalModal;
      keuntunganBersihEl.textContent = `Rp${bersih.toLocaleString()}`;
    }

    // === INIT ===
    loadModal();
  </script>
</body>
</html>
